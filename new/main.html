<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script src="https://cdn.staticfile.org/vue/2.2.2/vue.min.js"></script>
		<script type="text/javascript" src="js/update.js"></script>
		<!--Muse-UI框架引入-->
		<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
		<link rel="stylesheet" href="https://unpkg.com/muse-ui@3.0.2/dist/muse-ui.css" />
		<link rel="stylesheet" href="https://cdn.bootcss.com/material-design-icons/3.0.1/iconfont/material-icons.css">
		<script src="https://unpkg.com/vue/dist/vue.js"></script>
		<script src="https://unpkg.com/muse-ui@3.0.2/dist/muse-ui.js"></script>
		<script src="https://unpkg.com/element-ui@2.12.0/lib/index.js"></script>
		<script src="js/mui.js"></script>
		<script src="js/bluetooth/BluetoothTool.js"></script>
		<script src="js/log/log.js"></script>
		<script src="js/request/font_data.js"></script>
		<style>
			@import url("https://unpkg.com/element-ui@2.12.0/lib/theme-chalk/index.css");
			.material-icons:active {
				color: red;
			}

			.showdz {
				border: 2px solid #000000;
				border-radius: 5px;
				height: 6.25rem;
				width: 84rem;
			}
			.simalimg {
				border: 1px solid #000000;
				border-radius: 5px;
				padding: 5px 10px;
			}
		</style>
	</head>
	<body style="background: #555555;">
		<div id="app">
			<mu-appbar style="width: 100%;padding-top: 1.2rem;" color="primary">
				<mu-row gutter>
					<mu-col span="3">
						<div style="font-size: 16px;height: 20px;">
							<mu-menu slot="left">
								<mu-button flat><span>简易发送</span></mu-button>
								<mu-list slot="content">
									<mu-list-item button @click="back_img()">
										<mu-list-item-content>
											<mu-list-item-title>图像发送</mu-list-item-title>
										</mu-list-item-content>
									</mu-list-item>
									<mu-list-item button @click="back_clock()">
										<mu-list-item-content>
											<mu-list-item-title>时钟发送</mu-list-item-title>
										</mu-list-item-content>
									</mu-list-item>
								</mu-list>
							</mu-menu>
						</div>
					</mu-col>
					<mu-col span="6">

					</mu-col>
					<mu-col span="3">
						<span @click="back()">
							<i class="material-icons">
								reply
							</i>
						</span>
						<span>&nbsp;</span>
						<span>
							<i class="material-icons">
								settings_applications
							</i>
						</span>
					</mu-col>
				</mu-row>
			</mu-appbar>
			<div>
				<mu-flex class="select-control-row">
					<mu-checkbox v-model="is_showdz" label="预览" @click="set_showdz()"></mu-checkbox>
				</mu-flex>
			</div>
			<div style="height: 6.5rem; padding: 0.25rem;overflow: scroll;" >
				<mu-row gutter>
					<mu-col span="12" >
						<div class="showdz">
							<div :style="dz_show" id="dz" >

							</div>
						</div>
					</mu-col>
				</mu-row>
			</div>
			<div style="margin-top: 1rem;">
				<mu-tabs :value.sync="active" :full-width="true" indicator-color="#FFD700" style="height: 25px;">
					<mu-tab>字体</mu-tab>
					<mu-tab>标准颜色</mu-tab>
					<mu-tab>自定义</mu-tab>
					<mu-tab>特效</mu-tab>
				</mu-tabs>
				<div v-if="active === 0">
					<mu-container>
						<mu-row gutter>
							<mu-col span="6" lg="6" sm="6">
								<mu-select label="大小" v-model="font_size" style="color: #FFFFFF;" full-width>
									<mu-option v-for="option,index in fontSizeOptions" :key="option" :label="option.toString()" :value="option"></mu-option>
								</mu-select>
							</mu-col>
							<mu-col span="6" lg="6" sm="6">
								<mu-select label="字体" v-model="font_style" style="color: #FFFFFF;" full-width>
									<mu-option v-for="option,index in fontStyleOptions" :key="option" :label="option" :value="option"></mu-option>
								</mu-select>
							</mu-col>
						</mu-row>
					</mu-container>
					<mu-container>
						<mu-row gutter>
							<mu-col span="6" lg="6" sm="6">
								<mu-select label="字符" v-model="input_length" style="color: #FFFFFF;" disabled full-width>

								</mu-select>
							</mu-col>
							<mu-col span="6" lg="6" sm="6">
								<mu-select label="特效" v-model="effect" style="color: #FFFFFF;" full-width>
									<mu-option v-for="option,index in effectOptions" :key="option" :label="option" :value="option"></mu-option>
								</mu-select>
							</mu-col>
						</mu-row>

					</mu-container>
					<div style="padding: 2px;">
						<mu-text-field v-model="input_value" label="内容" full-width  @blur="preview()"></mu-text-field><br />
					</div>
					<div class="simalimg">
						<div style="text-align: center;">
							简易图像
						</div>
						<div>
							<div class="button-wrapper">
								<mu-button icon color="primary">
									<mu-icon value="grade"></mu-icon>
								</mu-button>
								<mu-button icon color="secondary">
									<mu-icon value="android"></mu-icon>
								</mu-button>
								<mu-button icon>
									<i class="material-icons">
										room
									</i>
								</mu-button>
								<mu-button icon color="red">
									<mu-icon value="thumb_up"></mu-icon>
								</mu-button>
								<mu-button icon color="red">
									<i class="material-icons">
										mail
									</i>
								</mu-button>
								<mu-button icon color="red">
									<i class="material-icons">
										call
									</i>
								</mu-button>
							</div>
							<div class="button-wrapper">
								<mu-button icon color="primary">
									<mu-icon value="grade"></mu-icon>
								</mu-button>
								<mu-button icon color="secondary">
									<mu-icon value="android"></mu-icon>
								</mu-button>
								<mu-button icon>
									<i class="material-icons">
										room
									</i>
								</mu-button>
								<mu-button icon color="red">
									<mu-icon value="thumb_up"></mu-icon>
								</mu-button>
								<mu-button icon color="red">
									<i class="material-icons">
										mail
									</i>
								</mu-button>
								<mu-button icon color="red">
									<i class="material-icons">
										call
									</i>
								</mu-button>
							</div>
						</div>
					</div>
				</div>
				<div v-if="active === 1">
					<div style="padding: 15px 10px;">

						<mu-flex align-items="center" style="padding-bottom: 8px;">
							<span>前景色 &nbsp; </span>
							<mu-radio v-model="foreground_color" style="margin-right: 16px;background: #FF0000;" value="#FF0000" @click="set_color()"></mu-radio>
							<mu-radio v-model="foreground_color" style="margin-right: 16px;background: #00FF00;" value="#00FF00" @click="set_color()"></mu-radio>
							<mu-radio v-model="foreground_color" style="margin-right: 16px;background: #0000FF;" value="#0000FF" @click="set_color()"></mu-radio>
							<mu-radio v-model="foreground_color" style="margin-right: 16px;background: #FFFF00;" value="#FFFF00" @click="set_color()"></mu-radio>
							<mu-radio v-model="foreground_color" style="margin-right: 16px;background: #FF00FF;" value="#FF00FF" @click="set_color()"></mu-radio>
							<mu-radio v-model="foreground_color" style="margin-right: 16px;background: #00FFFF;" value="#00FFFF" @click="set_color()"></mu-radio>
							<mu-radio v-model="foreground_color" style="margin-right: 16px;background: #FFFFFF;" value="#FFFFFF" @click="set_color()"></mu-radio>
						</mu-flex>
					</div>
					<div style="padding: 5px 10px;">

						<mu-flex align-items="center" style="padding-bottom: 8px;">
							<span>背景色 &nbsp; </span>
						
							<mu-radio v-model="background_color" style="margin-right: 16px;background: #FF0000;" value="224" @click="set_color()"></mu-radio>
							<mu-radio v-model="background_color" style="margin-right: 16px;background: #00FF00;" value="56" @click="set_color()"></mu-radio>
							<mu-radio v-model="background_color" style="margin-right: 16px;background: #0000FF;" value="3" @click="set_color()"></mu-radio>
							<mu-radio v-model="background_color" style="margin-right: 16px;background: #FFFF00" value="252" @click="set_color()"></mu-radio>
							<mu-radio v-model="background_color" style="margin-right: 16px;background: #FF00FF;" value="227" @click="set_color()"></mu-radio>
							<mu-radio v-model="background_color" style="margin-right: 16px;background: #00FFFF;" value="31" @click="set_color()"></mu-radio>
							<mu-radio v-model="background_color" style="margin-right: 16px;background: #000000;" value="0" @click="set_color()"></mu-radio>
						</mu-flex>
					</div>
				</div>
				<div v-if="active === 2">

					3
				</div>
				<div v-if="active === 3">

					<mu-container class="button-wrapper">
						<el-row style="margin-top: 1rem;">
							<el-button type="warning" size="mini" @click="button1()">随机</el-button>
							<el-button type="warning" size="mini" @click="button2()">左移</el-button>
							<el-button type="warning" size="mini" @click="button3()">右移</el-button>
							<el-button type="warning" size="mini" @click="button4()">上移</el-button>
							<el-button type="warning" size="mini" @click="button4()">下移</el-button>
						</el-row>
						<el-row style="margin-top: 1rem;">
							<el-button type="warning" size="mini" @click="button5()">固定</el-button>
							<el-button type="warning" size="mini" @click="button6()">闪烁</el-button>
							<el-button type="warning" size="mini" @click="button7()">淡出</el-button>
							<el-button type="warning" size="mini" @click="button8()">溶解</el-button>
							<el-button type="warning" size="mini" @click="button4()">旋转</el-button>
						</el-row>

						<mu-container>
				</div>



				<div style="margin: 10px 5px;">
					<mu-flex justify-content="center" align-items="center">
						<mu-button full-width color="primary" @click="send()">确认并发送</mu-button>
					</mu-flex>
				</div>
			</div>
		</div>
	</body>
	<script>
		var app = new Vue({
			el: "#app",
			data: {
				is_showdz: true,
				dz_show: {
					"visibility": "visible",
				},
				active: 1,
				font_size: 16,
				fontSizeOptions: [14, 16, 32],
				effect: '',
				effectOptions: ["x", "xs"],
				font_style: '',
				fontStyleOptions: ["宋体", "楷体"],
				inputLength: '0/20',
				input_value: 'Hello',
				foreground_color: '224',
				background_color: '0',
				dz_data :[],
				send_data : {
					header : {
						data : [85,0,1,1,1,1,1,1,0,96],
						isabled : true
					},
					main : {
						data : [],
						isabled : true
					},
					end : {
						data : [119,0,1,1,1,1,1,1,0,96],
						isabled :true
					},
					is_sending : false
				}
			},
			methods: {
				back() {
					window.location.href = "find_dev.html";
				},
				back_clock() {
					window.location.href = "clock_send.html";
				},
				back_img() {
					window.location.href = "img_send.html";
				},
				set_showdz() {
					console.log();
					if (this.is_showdz) {
						this.dz_show.visibility = "visible";
					} else {
						this.dz_show.visibility = "hidden";
					}
				},
				clear_input() {
					this.input_value = "5";
				},
				preview(){
					this.dz_data = [];
					document.getElementById("dz").innerHTML = "";
					for (var i = 0; i < this.input_value.length; i++) {
						this.request_fontdata(this.input_value[i],'hzk16s',i,this.foreground_color);
					}
				},
				request_fontdata(str,font,indexOf) {
					var dataArray = [];
					if (this.font_size == 16) {
						url = 'http://47.106.254.86:1234/server1.php';
					} else {
						url = 'http://47.106.254.86:1234/server2.php';
					}
					$.post(url, {
						txt: str,
						font: font
					}, function(data, status) {
						var srt = JSON.parse(data);
						//接收的16进制数据转2进制
						srt.forEach((item) => {
							var zero = '00000000';
							var hex = parseInt(item, 16).toString(2);
							var tmp = 8 - hex.length;
							dataArray.push(zero.substr(0, tmp) + hex);
							
						});
						app.dz_data.push({"index":indexOf,"data":dataArray,"img":false});
						if(app.dz_data.length==app.input_value.length){
							app.dz_data.sort(function(a,b){
								return a.index - b.index;
							})
							app.dz_data.forEach((item)=>{
								draw_font(item.data,document.getElementById("dz"),16,app.foreground_color);
							})	
						}
					});
				},
				set_color(){
					console.log(this.foreground_color);
					console.log(this.background_color);
				},
				send(){
					console.log(JSON.stringify(data_deal(this.dz_data,16)));
					this.send_data.main.data = data_deal(this.dz_data,16);
					var data = app.send_data.main.data;
					var communication = setInterval(function(){
						if(app.send_data.main.isabled){
							for (let i in data) {
								console.log(JSON.stringify(data[i]));
							}
						}
					})
				}
			},
			computed: {
				input_length: function() {
					this.dz_data.forEach((item)=>{
						//console.log(JSON.stringify(item));
					})
					return this.input_value.length + "/14";
				}
			}
		})
	</script>
</html>
